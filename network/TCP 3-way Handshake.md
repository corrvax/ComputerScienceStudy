<div align="center">
  <br />
  <h1> TCP 3-way Handshake</h1>
  <br />
</div>

## λ©μ°¨

1. [**TCP 3-way Handshake μ •μμ™€ μ—­ν• **](#1)
2. [**TCP 3-way Handshake κ³Όμ •**](#2)
3. [**TCP 4-way Handshake κ³Όμ •**](#3)

<br />

<div id="1"></div>

## TCP 3-way Handshake μ μ •μμ™€ μ—­ν• 

**μ •μ**<br /><br />
TCP/IP ν”„λ΅ν† μ½μ„ μ΄μ©ν•΄μ„ ν†µμ‹ μ„ ν•λ” μ‘μ©ν”„λ΅κ·Έλ¨μ΄ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•κΈ° μ „μ— λ¨Όμ € **μ •ν™•ν• μ „μ†΅μ„ λ³΄μ¥ν•κΈ° μ„ν•΄** μƒλ€λ°© μ»΄ν“¨ν„°μ™€ μ‚¬μ „μ— μ„Έμ…μ„ μλ¦½ν•λ” κ³Όμ •μ„ μλ―Έν•λ‹¤. 
<br/><br />
**μ—­ν• **
1. μ–‘μ½ λ¨λ‘ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•  μ¤€λΉ„κ°€ λμ—λ‹¤λ” κ²ƒμ„ λ³΄μ¥ν•κ³ , μ‹¤μ λ΅ μ „λ‹¬μ΄ μ‹μ‘λκΈ° μ „μ— ν•μ½μ΄ λ‹¤λ¥Έ μ½μ΄ μ¤€λΉ„λμ—λ‹¤λ” κ²ƒμ„ μ•μ μλ„λ΅ ν•λ‹¤. 
2. μ–‘μ½ λ¨λ‘ μƒλ€νΈμ— λ€ν• μ΄κΈ° μμ°¨ μΌλ ¨λ²νΈλ¥Ό μ–»μ„ μ μλ„λ΅ ν•λ‹¤.
<br />

<div id="2"></div>

## TCP 3-way Handshake κ³Όμ •


![enter image description here](https://t1.daumcdn.net/cfile/tistory/99FB2A3D5B32ED7B0B)

(SYN μ€ synchronize sequence numbers ACKλ” acknowledgements μ μ•½μ)

1. ν΄λΌμ΄μ–ΈνΈ(A)λ” μ„λ²„(B)μ— μ ‘μ†μ„ μ”μ²­ν•λ” SYN ν¨ν‚·μ„ λ³΄λ‚Έλ‹¤. μ΄λ• ν΄λΌμ΄μ–ΈνΈ(A)λ” SYNμ„ λ³΄λ‚΄κ³  SYN/ACK μ‘λ‹µμ„ κΈ°λ‹¤λ¦¬λ” SYN_SENT μƒνƒκ°€ λλ‹¤.
2. μ΄λ• μ„λ²„(B)λ” Listen μƒνƒλ΅ ν¬νΈ μ„λΉ„μ¤κ°€ κ°€λ¥ν• μƒνƒμ—¬μ•Ό ν•λ‹¤. (Closed :λ‹«νμƒνƒ) μ„λ²„(B)λ” SYN μ”μ²­μ„ λ°›κ³  ν΄λΌμ΄μ–ΈνΈ(A)μ—κ² μ”μ²­μ„ μλ½ν•λ‹¤λ” ACKμ™€ SYN flagκ°€ μ„¤μ •λ ν¨ν‚·μ„ λ°μ†΅ν•κ³  ν΄λΌμ΄μ–ΈνΈ(A)κ°€ λ‹¤μ‹ ACKμΌλ΅ μ‘λ‹µν•κΈ°λ¥Ό κΈ°λ‹¤λ¦°λ‹¤. μ΄λ• μ„λ²„(B)λ” SYN_RECEIVED μƒνƒκ°€ λλ‹¤.
3. ν΄λΌμ΄μ–ΈνΈ(A)λ” μ„λ²„(B)μ—κ² ACKμ„ λ³΄λ‚΄κ³  μ΄ν›„λ΅λ¶€ν„°λ” μ—°κ²°μ΄ μ΄λ£¨μ–΄μ§€κ³  λ°μ΄ν„°κ°€ μ¤κ°€κ² λλ‹¤. μ΄λ•μ μ„λ²„(B) μƒνƒκ°€ μ„±λ¦½(ESTABLISHED) μ΄λ‹¤.

μ„μ™€ κ°™μ€ λ°©μ‹μΌλ΅ ν†µμ‹ ν•λ”κ²ƒμ΄ μ‹ λΆ°μ„± μλ” μ—°κ²°μ„ λ§Ίμ–΄ μ¤€λ‹¤λ” TCPμ 3 Way handshake λ°©μ‹μ΄λ‹¤.

 
| μƒνƒ | μ„¤λ… |
|--|--|
| Closed  | λ‹«ν μƒνƒ  |
| Listen  | ν¬νΈκ°€ μ—΄λ¦° μƒνƒλ΅ μ—°κ²° μ”μ²­ λ€κΈ°μ¤‘μΈ μƒνƒ  |
| SYN-send| SYN μ”μ²­μ„ ν• μƒνƒ  |
| SYN-Received  | SYN μ”μ²­μ„ λ°›κ³  μƒλ€λ°©μ μ‘λ‹µμ„ κΈ°λ‹¤λ¦¬λ” μƒνƒ  |
| ESTABLISHED | μ—°κ²°μ΄ ν™•μΈλ μƒνƒ  |


<br />

<div id="3"></div>

## TCP 4-way Handshaking κ³Όμ •
**μ •μ** <br /><br />
μ„Έμ…μ„ μΆ…λ£ν•κΈ° μ„ν•΄ μν–‰λλ” κ³Όμ • 

![enter image description here](https://t1.daumcdn.net/cfile/tistory/2152353F52F1C02835)

1. FIN (+ACK) μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ TCP μ—°κ²°μ΄ λμ–΄μλ” μƒνƒμ—μ„ ν΄λΌμ΄μ–ΈνΈκ°€ μ ‘μ†μ„ λκΈ° μ„ν•΄ close( )λ¥Ό νΈμ¶ν•λ‹¤. ν΄λΌμ΄μ–ΈνΈκ°€ close( )λ¥Ό νΈμ¶ν•λ©΄μ„ μ„λ²„μ—κ² FIN ν¨ν‚·μ„ λ³΄λ‚΄κ² λκ³  ν΄λΌμ΄μ–ΈνΈλ” FIN_WAIT_1 μƒνƒλ΅ λ“¤μ–΄κ°„λ‹¤.
2. ACK μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈμ—κ² μ‘λ‹µμ„ λ³΄λ‚΄κ³  CLOSE_WAIT μƒνƒμ— λ“¤μ–΄κ°„λ‹¤. κ·Έλ¦¬κ³  μ•„μ§ λ‚¨μ€ λ°μ΄ν„°κ°€ μλ‹¤λ©΄ λ§μ € μ „μ†΅μ„ λ§μΉ ν›„μ— close( )λ¥Ό νΈμ¶ν•λ‹¤.
3. FIN_WAIT_2 ν΄λΌμ΄μ–ΈνΈμ—μ„λ” μ„λ²„μ—μ„ ACKλ¥Ό λ°›μ€ ν›„μ— μ„λ²„κ°€ λ‚¨μ€ λ°μ΄ν„° μ²λ¦¬λ¥Ό λλ‚΄κ³  FIN ν¨ν‚·μ„ λ³΄λ‚Ό λ•κΉμ§€ κΈ°λ‹¤λ¦¬κ² λ©λ‹λ‹¤.
4. FIN μ„λ²„λ” μ΄μ  λ¨λ“  λ°μ΄ν„° μ²λ¦¬κ°€ λλ‚¬λ‹¤κ³  μΆ…λ£μ— ν•©μ ν•λ‹¤λ” λ»μΌλ΅ ν΄λΌμ΄μ–ΈνΈμ—κ² FIN ν¨ν‚·μ„ λ³΄λ‚Έ ν›„μ— μΉμΈ λ²νΈλ¥Ό λ³΄λ‚΄μ¤„ λ•κΉμ§€ κΈ°λ‹¤λ¦¬λ” LAST_ACK μƒνƒλ΅ λ“¤μ–΄κ°„λ‹¤.
5. ACK ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ—μ„ FIN ν¨ν‚·μ„ λ°›κ³  λ‚μ„ λ‹¤μ‹ μ„λ²„μ—κ² ACK μ‘λ‹µμ„ λ³΄λ‚Έ ν›„μ— TIME_WAIT μƒνƒλ΅ λ“¤μ–΄κ°€λ©° μ‹¤μ§μ μΈ μΆ…λ£ κ³Όμ •(CLOSED)μ— λ“¤μ–΄κ°€κ² λλ‹¤. μ΄λ• TIME_WAIT μƒνƒλ” **μλ„μΉ μ•μ€ μ—λ¬λ΅ μΈν•΄ μ—°κ²°μ΄ λ°λ“λ½μΌλ΅ λΉ μ§€λ” κ²ƒμ„ λ°©μ§€**ν•λ”λ°, λ§μ•½ μ—λ¬λ΅ μΈν•΄ μΆ…λ£κ°€ μ§€μ—°λλ‹¤κ°€ νƒ€μ„μ΄ μ΄κ³Όλλ©΄ CLOSEDλ΅ λ“¤μ–΄κ°„λ‹¤.
6. CLOSED μ„λ²„λ” ACKλ¥Ό λ°›κ³  CLOSED μƒνƒλ΅ λ“¤μ–΄κ°€ μΆ…λ£ν•κ² λλ‹¤.
<br />

**π’΅ TIME_WAIT μ΄λ€?**<br />
<br />
μ„λ²„κ°€ FINμ„ μ „μ†΅ν•κΈ° μ „μ— μ „μ†΅ν• ACK ν¨ν‚·μ΄ Routing μ§€μ—°μ΄λ‚ ν¨ν‚· μ μ‹¤λ΅ μΈν• μ¬μ „μ†΅μΌλ΅ FIN ν¨ν‚·λ³΄λ‹¤ λ¦κ² λ„μ°© ν•  μ μλ‹¤. μ΄ κ²½μ° **λ°μ΄ν„°κ°€ μ μ‹¤**λκΈ° λ•λ¬Έμ— μ΄λ¥Ό **λ€λΉ„**ν•μ—¬ ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„λ΅λ¶€ν„° FINμ„ μμ‹ ν•λ”λΌλ„ **μΌμ •μ‹κ°„(2MSL time out = Maximum Segment Lifetimeμ 2λ°°) λ™μ• μ„Έμ…μ„ λ‚¨κ²¨ λ†“κ³  μ‰μ—¬ ν¨ν‚·μ„ κΈ°λ‹¤λ¦¬λ” κ³Όμ •**μ„ λ§ν•λ‹¤.  
  
  
